quarkus.application.name=opensearch-manager
quarkus.application.version=@version@

# Container image configuration
quarkus.container-image.registry=ghcr.io
quarkus.container-image.group=ai-pipestream
quarkus.container-image.name=opensearch-manager
quarkus.container-image.tag=latest

# Quarkus Index Dependencies (CRITICAL for ConfigMapping discovery)
quarkus.index-dependency.pipestream-registration.group-id=ai.pipestream
quarkus.index-dependency.pipestream-registration.artifact-id=pipestream-service-registration
quarkus.index-dependency.pipestream-dynamic-grpc.group-id=ai.pipestream
quarkus.index-dependency.pipestream-dynamic-grpc.artifact-id=quarkus-dynamic-grpc

# Production port allocation
quarkus.http.port=38103
quarkus.http.host=0.0.0.0
quarkus.grpc.server.use-separate-server=false
quarkus.grpc.server.enable-health-service=true

# Development overrides
%dev.quarkus.http.port=38103
%dev.quarkus.http.root-path=/opensearch-manager

# Compose Dev Services - Use shared dev services via extension
%dev.quarkus.compose.devservices.enabled=true
%dev.quarkus.compose.devservices.files=${user.home}/.pipeline/compose-devservices.yml
%dev.quarkus.compose.devservices.project-name=pipeline-shared-devservices
%dev.quarkus.compose.devservices.start-services=true
%dev.quarkus.compose.devservices.stop-services=false
%dev.quarkus.devservices.timeout=120s

# Disable standalone devservices since we're using Compose Dev Services
%dev.quarkus.datasource.devservices.enabled=false

# ======================================================================================================================
# Service Registration Configuration
# ======================================================================================================================
pipestream.registration.enabled=true
pipestream.registration.service-name=opensearch-manager
pipestream.registration.description=OpenSearch indexing and search management service
pipestream.registration.type=SERVICE
pipestream.registration.advertised-host=${SERVICE_REGISTRATION_ADVERTISED_HOST:host.docker.internal}
pipestream.registration.advertised-port=${quarkus.http.port}
# Internal host/port for Docker - Consul uses this for health checks
pipestream.registration.internal-host=${SERVICE_REGISTRATION_INTERNAL_HOST:172.17.0.1}
pipestream.registration.internal-port=${quarkus.http.port}
pipestream.registration.capabilities=opensearch-indexing,search-management,kafka-consumer
pipestream.registration.tags=opensearch,indexing,search,kafka-consumer

# Registration service connection
pipestream.registration.registration-service.host=localhost
pipestream.registration.registration-service.port=38101

quarkus.grpc.server.enable-reflection-service=true

# Health checks
quarkus.smallrye-health.root-path=/q/health
quarkus.smallrye-health.liveness-path=/q/health/live
quarkus.smallrye-health.readiness-path=/q/health/ready

# Logging Configuration
quarkus.log.level=INFO
quarkus.log.category."ai.pipestream".level=INFO
quarkus.log.category."io.vertx.ext.consul".level=WARN
%dev.quarkus.log.console.level=INFO
%dev.quarkus.log.category."io.quarkus.grpc".level=WARN
%dev.quarkus.log.category."io.smallrye.stork".level=WARN

# OpenSearch Configuration
opensearch.hosts=${OPENSEARCH_HOST:localhost}:${OPENSEARCH_PORT:9200}
opensearch.protocol=http
opensearch.username=${OPENSEARCH_USERNAME:}
opensearch.password=${OPENSEARCH_PASSWORD:}

# Schema manager specific configuration
schema.manager.lock.timeout=PT10S

# Kafka Configuration
kafka.bootstrap.servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9094}
kafka.group.id=opensearch-manager

# Kafka Consumers - extension auto-configures deserializers for Protobuf types
mp.messaging.incoming.drive-updates-in.connector=smallrye-kafka
mp.messaging.incoming.drive-updates-in.topic=drive-updates

mp.messaging.incoming.repository-document-events-in.connector=smallrye-kafka
mp.messaging.incoming.repository-document-events-in.topic=repository-events

mp.messaging.incoming.module-updates-in.connector=smallrye-kafka
mp.messaging.incoming.module-updates-in.topic=module-updates

mp.messaging.incoming.pipedoc-updates-in.connector=smallrye-kafka
mp.messaging.incoming.pipedoc-updates-in.topic=pipedoc-updates

mp.messaging.incoming.process-request-updates-in.connector=smallrye-kafka
mp.messaging.incoming.process-request-updates-in.topic=process-request-updates

mp.messaging.incoming.process-response-updates-in.connector=smallrye-kafka
mp.messaging.incoming.process-response-updates-in.topic=process-response-updates

mp.messaging.incoming.graph-updates-in.connector=smallrye-kafka
mp.messaging.incoming.graph-updates-in.topic=graph-updates

# Test Profile Configuration
%test.quarkus.devservices.enabled=true
%test.quarkus.compose.devservices.files=src/test/resources/compose-test-services.yml
%test.quarkus.compose.devservices.start-services=true
%test.quarkus.compose.devservices.project-name=pipeline-test-services
%test.quarkus.compose.devservices.stop-services=false
%test.quarkus.compose.devservices.reuse-project-for-tests=true
%test.quarkus.compose.devservices.stop-timeout=30s

# Disable individual devservices (compose provides everything)
%test.quarkus.datasource.devservices.enabled=false
%test.quarkus.kafka.devservices.enabled=false

# Test Kafka and Apicurio config
%test.kafka.bootstrap.servers=${TEST_KAFKA_HOST:localhost}:${TEST_KAFKA_PORT:9095}
%test.mp.messaging.connector.smallrye-kafka.bootstrap.servers=${TEST_KAFKA_HOST:localhost}:${TEST_KAFKA_PORT:9095}
%test.mp.messaging.connector.smallrye-kafka.apicurio.registry.url=http://${APICURIO_REGISTRY_TEST_HOST}:${APICURIO_REGISTRY_TEST_PORT_8080}/apis/registry/v3

# Test outgoing channel for drive-updates
%test.mp.messaging.outgoing.drive-updates-out.connector=smallrye-kafka
%test.mp.messaging.outgoing.drive-updates-out.topic=drive-updates

# OpenSearch test configuration
%test.opensearch.hosts=${TEST_OPENSEARCH_HOST:localhost}:${TEST_OPENSEARCH_PORT:9201}

# Test HTTP configuration
%test.quarkus.http.test-port=0

# Disable service registration in tests
%test.pipestream.registration.enabled=false

# Wiremock for gRPC registration service
%test.quarkus.wiremock.devservices.enabled=true
%test.quarkus.wiremock.devservices.extension-scanning-enabled=true
%test.quarkus.wiremock.devservices.files-mapping=classpath:META-INF
%test.quarkus.wiremock.devservices.global-response-templating=true
